---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Maja Abraham"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme: Analiza spletnih nakupov posameznikov v EU

Nakupovanje v spletnih trgovinah postaja vedno bolj priljubljeno, zato sem se odločila za analizo podatkov o spletnem nakupovanju v državah EU. Zanimajo me predvsem pogostost omenjenega načina nakupovanja v posameznih državah EU, nakupovalne navade posameznikov, ki kupujejo/ naročajo na spletu ter težave, ki se pojavijo pri spletnih nakupih. Pozorna bom tudi na gibanje opazovanih podatkov skozi čas ter morebitne povezave, ki se pojavijo med njimi npr. kako so povezani pogostost spletnega nakupovanja in številčnost težav, ki se pri tem pojavijo, katere starostne skupine kupujejo več in katere izdelke...

![](slike/e_nakupovanje.png)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Večino podatkov sem pridobila iz spletne strani [Eurostat](https://ec.europa.eu/eurostat). Podatki so dostopni v različnih formatih. Uvozila sem 6 tabel v formatih CSV, HTML in XLS.
Poleg omenjenih podatkov sem uporabila še tabelo, v kateri se nahajajo podatki o najbolj priljubljenih spletnih trgovinah v Evropi. Tabela se nahaja na naslednji povezavi: https://www.webretailer.com/b/online-marketplaces-europe/

Podatki shranjeni v formatu CSV so že skoraj v obliki *tidy data*, potrebno je le ločiti nekatere stolpce in prevesti vsebino podatkov, saj so vsi podatki v angleščini. Vse ostale podatke pa je potrebno še preoblikovati in prečistiti. 

1. `pogostost` - podatki o pogostosti spletnega nakupovanja po letih, državah, storostni skupini in spolu
  - `leto` - spremenljivka: leta od 2016 do 2019 (število),
  - `drzava` - spremenljivka:  imena držav članic EU in  EU28 (zajema EU povprečje, ki vključuje še Veliko Britanijo),
  - `starostna skupina` - spremenljivka: podatek o starostni skupini, razdeljeno v kategorije (niz),
  - `spol` - spremenljivka: podatek o spolu (moški, ženski in skupna vrednost),
  - `pogostost` - spremenljivka: število spletnih nakupov v obdobju treh mesecev (niz),
  - `odstotek` - meritev: odstotek populacije pri določenem številu spletnih nakupov, ki ustreza ostalim pogojem iz stolpcev (število).

2. `zadnji.nakup` - podatki o preteklem času od zadnjega spletnega nakupa po letih, državah, storostni skupini in spolu
  - `leto` - spremenljivka: leta od 2010 do 2019 (število),
  - `drzava` - spremenljivka:  imena držav članic EU in  EU28 (zajema EU povprečje, ki vključuje še Veliko Britanijo),
  - `starostna skupina` - spremenljivka: podatek o starostni skupini, razdeljeno v kategorije (niz),
  - `spol` - spremenljivka: podatek o spolu (moški, ženski in skupna vrednost),
  - `zadnji e-nakup` - spremenljivka: podatki o tem, kdaj je bil opravljen zadnji spletni nakup (niz),
  - `odstotek` - meritev: odstotek populacije ki je svoj zadnji nakup opravil v določenem časovnem obdobju posameznega leta, ki ustreza ostalim pogojem iz stolpcev (število).

3. `vrsta.blaga` - podatki o odstotku kupcev, ki so kupovali posamezno vrsto blaga ali storitve po letih, državah, storostni skupini in spolu
  - `leto` - spremenljivka: leta od 2010 do 2019 (število),
  - `drzava` - spremenljivka:  imena držav članic EU in  EU28 (zajema EU povprečje, ki vključuje še Veliko Britanijo),
  - `starostna skupina` - spremenljivka: podatek o starostni skupini, razdeljeno v kategorije (niz),
  - `spol` - spremenljivka: podatek o spolu (moški, ženski in skupna vrednost),
  - `vrsta blaga` - spremenljivka: podatki o vrsah blaga/storitev,
  - `odstotek` - meritev: odstotek kupcev ki so kupili določeno vrsto blaga/storitev pri ostalih pogojih iz stolpcev (število).

4. `vrednosti` - podatki o vrednosti spletnih nakupov po letih, državah, storostni skupini in spolu
  - `leto` - spremenljivka: leta od 2015 do 2019 (število),
  - `drzava` - spremenljivka:  imena držav članic EU in  EU28 (zajema EU povprečje, ki vključuje še Veliko Britanijo),
  - `starostna skupina` - spremenljivka: podatek o starostni skupini, razdeljeno v kategorije (niz),
  - `spol` - spremenljivka: podatek o spolu (moški, ženski in skupna vrednost),
  - `vrednost` - spremenljivka: skupne vrednosti spletnih nakupov za obdobje treh mesecev (vrednosti so razdeljene v kategorije, v EUR, niz),
  - `odstotek` - meritev: odstotek kupcev, ki so v treh mesecih v spletnih trgovinah porabili sredstva v vrednosti kategorije pri ostalih pogojih iz stolpcev (število).

5. `izvor` - podatki o odstotku kupcev, ki so kupovali od prodajalcev kategoriziranih po izvoru glede na leto, državo, storostno skupino in spol
  - `leto` - spremenljivka: leta od 2010 do 2019 (število),
  - `drzava` - spremenljivka:  imena držav članic EU in  EU28 (zajema EU povprečje, ki vključuje še Veliko Britanijo),
  - `starostna skupina` - spremenljivka: podatek o starostni skupini, razdeljeno v kategorije (niz),
  - `spol` - spremenljivka: podatek o spolu (moški, ženski in skupna vrednost),
  - `prodajalec` - spremenljivka: podatki o regionalnem izvoru prodajalca (domač, iz EU ali iz drugih držav),
  - `odstotek` - meritev: odstotek kupcev, ki so kupovali od prodajalcev kategoriziranih po izvoru ter  ustreza ostalim pogojem iz preostalih stolpcev (število).
  
6. `tezave` - podatki o težavah, s katerimi se srečujejo kupci pri spletnih nakupih po letih in državah
  - `leto` - spremenljivka: leta 2009, 2015-2017, 2019 (število),
  - `drzava` - spremenljivka:  imena držav članic EU in  EU28 (zajema EU povprečje, ki vključuje še Veliko Britanijo),
  - `tezava` - spremenljivka: podatki o težavah, ki se pojavljajo pri spletnem nakupovanju,
  - `odstotek` - meritev: odstotek kupcev, ki je navedel določeno težavo v posameznem letu in državi (število).
  
7. `top10` - podatki o najbolj obiskanih spletnih trgovinah s strani evropejcev
  - `ime` - spremenljivka: ime spletne trgovine,
  - `regija / drzava` - meritev:  regija oz. država iz katere spletna trgovina izvira,
  - `obiski/mesec` - meritev: število obiskov, ki jih mesečno prejme spletna trgovina (število),
  - `enota` - meritev: podatek o enoti merjenja obiskov (M pomeni milijon, B pa bilijon).

Spodnji grafi prikazujejo odstotke prebivalstva posamezne države, ki so v posameznih letih spletno nakupovali po kategorijah pogostosti. Tako npr. rdeče črte prikazujejo odstotek posameznikov, ki so v obdobju treh mesecev opravili 1 ali 2 spletna nakupa...
Opazimo, da se v večini držav odstotek prebivalstva, ki kupuje v spletnih trgovinah veča, vendar pa pri večini prednjačijo kupci, ki se le občasno odločijo za spletni nakup, torej 1 do 2 nakupa v treh mesecih. V nadaljni analizi bom pozorna, kako se deleži spletnih nakupov spreminjajo po spolu in starostni skupini. Omejila se bom na posamezne države. Opazovala bom tudi gibanje podatkov iz razpredelnice o času zadnjega spletnega nakupa, saj predvidevam, da bi bili podatki lahko povezani z pogostostjo nakupovanja. Predvidevam, da se bo pojavila tudi povezava z vrednostjo nakupov.

```{r fig.align='center'}
pogostost %>% 
  filter(spol == "skupaj", `starostna skupina`=="skupaj") %>%
  select(-spol, -`starostna skupina`) %>% 
  ggplot(aes(x=leto, y=odstotek, col=pogostost)) +
  geom_line() + 
  facet_wrap(~drzava, ncol=7) + 
  scale_x_log10() +
  theme(axis.text.x = element_text(size = 7, angle = 90)) +
  ggtitle("Pogostost spletnega nakupovanja po letih in državah")
```
Na spodnjem grafikonu vidimo odstotke kupcev, ki so v EU leta 2019 na spletu kupili posamezno vrsto blaga oz. storitve. Opazimo, da je največ kupcev kupio oblačila ali športno opremo. Sorazmerno velik delž kupcev je kupil tudi počitniške nastanitve ter filme, glasbo, knjige in programsko računalniško opremo. V nadaljni analizi bom primerjala še ostale deleže po letih, vendar pa predvidevam da se podatki bistveno ne bodo razlikovali. Primerjala bom tudi razmere v različnih državah in po spolu.
```{r fig.align='center'}
vrsta.blaga %>%
  filter(`starostna skupina`=="skupaj", drzava == "EU28", leto==2019) %>%
  select(-drzava, -`starostna skupina`) %>%
  ggplot(aes(x=`vrsta blaga`, y=odstotek)) +
  geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(size = 8)) +
  ggtitle("Odstotek kupcev, ki je v EU leta 2019 v spletnih trgovinah kupil posamezno vrsto blaga")+
  ylab("odstotki") + xlab(NULL)
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```
Analizo sem pričela s pregledom pogostosti nakupovanja, da bi dobila boljšo predstavo o tem, koliko prebivalcev uporablja spletno nakupovanje in kako pogosto. Podatki se v posameznih državah zelo razlikujejo, vendar pa sem našla nekaj povezav in skupnih točk.

```{r, figures-side, fig.show="hold", out.width="50%"}
pogostost %>% 
  filter(spol == "skupaj", drzava == "Italija"| drzava == "EU28" | drzava == "Nizozemska") %>%
  ggplot(aes(x=leto, y=odstotek, fill=pogostost)) +
    geom_col() +
  facet_grid(drzava~`starostna skupina`) +
  geom_text(aes(label=odstotek), position = "stack" , size = 3) +
  theme(axis.text.x = element_text(angle = 45)) +
  scale_fill_brewer(palette = "Oranges") +
  labs(title = "Pogostost spletnega nakupovanja po starostnih skupinah")

zadnji.nakup %>% 
  filter(spol == "skupaj", drzava == "Italija"| drzava == "EU28" | drzava == "Nizozemska") %>%
  ggplot(aes(x=leto, y=odstotek, fill=`zadnji e-nakup`)) +
  geom_col() +
  facet_grid(drzava~`starostna skupina`) +
  theme(axis.text.x = element_text(angle = 45)) +
  labs(title = "Podatki o zadnjem spletnem nakupu po starostnih skupinah") 

```
Pri analizi pogostosti spletnega nakupovanja v državah EU bi lahko države grobo razdelili na 3 skupine. Zgornja slika prikazuje grafe držav, ki bi jih lahko uvrstili v omenjene skupine. Grafi kažejo odstotek prebivalstva države po letih, glede na starostno skupino, ki so v obdobju treh mesecev opravili  določeno število spletnih nakupov. V prvo skupino sem uvrstila države, ki imajo podobno sliko, kot povprečje EU, v drugo skupino spadajo države z izjemno nizkim deležem prebivalstva, ki kupuje na spletu in v tretjo skupino države, katerih se delež kupcev na spletu skupno giba okrog 70% prebivalstva ali več. Takoj opazimo, da je vsem državam EU skupen nižji delež kupcev v starostni skupini od 55 do 74 let. Povsod je tudi razvidno, da skupni deleži vseh kupcev po letih rahlo naraščajo. Vendar pa se zdi, da se rast v državah z velikim deležem spletnih kupcev kot so Nizozemska, Nemčija, Švedska, zaustavlja in ponekod tudi že pada. K rasti večinoma prispeva povečanje deležea tistih, ki v treh mesecih opravijo vsaj 6 nakupov, vendar pa velika večina prebivalcev EU opravi največ 5 spletnih nakupov v treh mesecih. Večina opazovanih držav sodi v povprečje EU, kjer so deleži pogostosti relativno izenačeni. v državah z zelo majhnim deležem kupcev, kamor poleg Italije sodijo tudi Romunija, Bolgarija, Ciper, pa je tudi pogostost omenjenega načina nakupovanja manjša.

Če pogledamo še grafe, ki prikazujejo deleže prebivalstva razdeljene po tem, kdaj so opravili zadnji spletni nakup po letih. Hitro lahko opazuimo, da bi se morali deleži načeloma sešteti v 100, kar bi predstavljalo vso prebivalstvo, saj so tudi kategorije tako razdeljene, vendar pa predvidevam da je moralo priti do nekakšne napake pri zbiranju podatkov. Najverjetneje je problem pri kategoriji zadnji nakup pred več kot enim letom ali nikoli. Zdi se, da v tej kategoriji niso bili zabeleženi vsi podatki. Vendar pa kljub nejasnostim grafi dovolj dobro prikazujejo stanje, da opazimo povezavo s grafi o pogostosti. Odstotki prebivalcev, ki so nakupovali v zadnjih treh mesecih so ustrezno visoki/nizki glede na skupni delež kupcev v grafih o pogostosti spletnega nakupovanja, saj so tam zajeti prav deleži kupcev za obdobje treh mesecev. Nova zanimivost, ki jo opazimo pa je konstantno nizek delež kupcev ki so svoj zadnji spletni nakup opravili med 3. in 12. meseci. Tako lahko sklepamo da večina prebivalstva ali kupuje redno, bolj pogosto, ali pa le občasno/nikoli, vmesne kategorije skoraj ni.

***

# Napredna analiza podatkov

```{r analiza}
source("analiza/analiza.r", encoding="UTF-8")
```

***

```{r shiny}
#shinyAppDir("shiny", options=list(width="100%", height=600))
```
